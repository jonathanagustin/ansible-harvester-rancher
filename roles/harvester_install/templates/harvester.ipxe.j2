#!ipxe

# iPXE script for booting Harvester installer
# This file is generated by Ansible. Manual changes will be overwritten.

# Set some variables
set base-url http://{{ nginx_server }}
set harvester-kernel ${base-url}/harvester-vmlinuz
set harvester-initrd ${base-url}/harvester-initrd
set harvester-rootfs ${base-url}/harvester-rootfs
set harvester-config ${base-url}/harvester-config.yaml

# Set the console based on the system type
iseq ${platform} efi && set console ttyS1,115200n8 || set console ttyS0,115200n8

# Set kernel command line parameters
set kernel-params initrd=harvester-initrd harvester.install.automatic=true console=${console} harvester.install.config_url=${harvester-config}

# Show some information
echo Booting Harvester Installer
echo Base URL: ${base-url}
echo Kernel: ${harvester-kernel}
echo Initrd: ${harvester-initrd}
echo RootFS: ${harvester-rootfs}
echo Config: ${harvester-config}
echo Kernel params: ${kernel-params}

# Download the kernel
kernel ${harvester-kernel} ${kernel-params}

# Download the initrd
initrd ${harvester-initrd}

# Boot
boot