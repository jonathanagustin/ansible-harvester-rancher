---
# Harvester Configuration
# This file is generated by Ansible. Manual changes will be overwritten.

# Scheme version
scheme_version: 1

# Server URL (for the first node in the cluster)
server_url: {{ hostvars[groups['idrac_hosts'][0]]['ansible_host'] }}

# Cluster token
token: {{ cluster_token }}

# OS Configuration
os:
  hostname: harvester-{{ inventory_hostname | regex_replace('\\.', '-') }}
  ssh_authorized_keys:
    - {{ ssh_public_key }}
  password: "{{ harvester_password | default('') }}"
  ntp_servers:
{% for server in ntp_servers.split(',') %}
    - {{ server }}
{% endfor %}

# Network Configuration
network:
  interfaces:
    - name: {{ pxe_harvester_mgmt_interface }}
      ip: {{ inventory_hostname }}/{{ netmask }}
      gateway: {{ gateway }}
  dns_nameservers:
{% for server in dns_servers.split(',') %}
    - {{ server }}
{% endfor %}

# Cluster Configuration
cluster:
  token: "{{ cluster_token }}"
  server_url: {{ pxe_harvester_vip }}
  {% if inventory_hostname == groups['idrac_hosts'][0] %}
  mode: create
  {% else %}
  mode: join
  {% endif %}

# Storage Configuration
storage:
  os_disk: {{ pxe_harvester_osdisk }}
  data_disk: {{ pxe_harvester_datadisk }}

{% if configure_additional_storage | default(false) %}
# Additional Storage Configuration
  longhorn:
    default_storage_class: true
    default_replica_count: 3
{% endif %}

{% if configure_additional_network | default(false) %}
# Additional Network Configuration
  networks:
    - name: additional-network
      cidr: {{ additional_network_cidr }}
{% endif %}

{% if enable_monitoring | default(false) %}
# Monitoring Configuration
monitoring:
  enabled: true
{% endif %}

{% if enable_backup | default(false) %}
# Backup Configuration
backup:
  enabled: true
  storage:
    s3:
      bucket: {{ backup_s3_bucket }}
      region: {{ backup_s3_region }}
      endpoint: {{ backup_s3_endpoint }}
{% endif %}

# Additional Settings
settings:
  ui-source: auto
  ui-index: https://releases.rancher.com/harvester-ui/latest/index.html